# Code 401 - Read 09

## Revision

* What header(s) are used in authentication and authorization

**Authentication**: the HTTP WWW-Authenticate response header defines the HTTP authentication methods (challenges) that might be used to gain access to a specific resource. Multiple challenges are allowed in one `WWW-Authenticate` header, and multiple `WWW-Authenticate` headers are allowed in one response. Syntax:

```
WWW-Authenticate: <auth-scheme> challenge1, ..., challengeN
```

The most common authentication scheme `<auth-scheme>` types are:

1. *Basic* - the client sends un-encrypted base64 encoded username and password text. It should only be used with HTTPS, as the password can be easily captured and reused over HTTP.

2. *Digest*- the client sends a hashed form of the password to the server. Although, the password cannot be captured over HTTP, it may be possible to replay requests using the hashed password.

3. *NTLM* - this uses a secure challenge/response mechanism that prevents password capture or replay attacks over HTTP.

[resource1](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization)
[resource2](https://www.httpwatch.com/httpgallery/authentication/)

**Authorization**: the HTTP Authorization request header can be used to provide credentials that authenticate a user agent with a server, allowing access to a protected resource. it is usually sent after the user agent first attempts to request a protected resource without credentials. The server responds with a `401 Unauthorized` message that includes at least one `WWW-Authenticate` header. This header indicates what authentication schemes can be used to access the resource. This header is part of the General HTTP authentication framework. It can be used with a number of authentication schemes. Syntax:

```
Authorization: <auth-scheme> <authorisation-parameters>
```

* What is safe to put into a JWT

1. Registered claims like subject, issuer, expiration time, etc.
2. Public claims with public names or unique values like email, address or phone number, etc.
3. Private claims to use in your own context and values can collision

[resource](https://stackoverflow.com/questions/38897514/what-to-store-in-a-jwt)

* How are JWTs validated

Validation of the JWT is about getting to a point where we can effectively compare the JWT we receive to what we expect.

1. *Retrieve, parse then decode the token*: the application can decode the header and payload to get some information. For example, by decoding the header segment we can see what algorithm the token was signed with. The application should be configured to expect the algorithm that the authorization server (token issuer) uses. If the decoded algorithm of the header doesn't match the expectation, the token will be rejected.
If the algorithm in the token matches our expectation, the app will generate the of the header and payload segments. This will reproduce the signing input hash. Hashing is irreversible, but the same input will always produce the same output. So, generating the hash from the received header and payload should match the header and payload hash that is encrypted in the signature.
2. *Verify the signature used to sign the access token*: the hashed signing input is also in the signature, but it's been encrypted by the authorization server with a private key. The application has the public key, so we can decrypt the signature. Once this is done, we have access to the original hash: the one generated by the authorization server when the token was first generated. Now we can compare the decrypted hash to the calculated hash. If they are the same, then we've verified that the data in the JWT header and payload segments has not been modified between the time the authorization server created the token and the time our application received it.
3. *Verify the claims found inside the access token*: claims in the payload segment should also be validated, because they contain information about the token issuer, token expiration, intended audience for the token, and more.

[resource](https://dev.to/kimmaida/signing-and-validating-json-web-tokens-jwt-for-everyone-25fb)

## Terms Documentation

* *RBAC* - Role-Based Access Control - an approach of restricting system access to authorized users based on their role in an organization.
* *User Roles* - permission sets that control access to areas and features within the server.
* *JWT Token* - a standard that defines a way for transmitting information securely between parties as a JSON object. This information can be verified and trusted because it is digitally signed.
